<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Augmented Reality</title>
</head>
<body style="margin : 0; overflow: hidden;">
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.js"></script>
<script src="https://jeromeetienne.github.io/AR.js/three.js/examples/vendor/three.js/examples/js/libs/stats.min.js"></script>

<script src="https://jeromeetienne.github.io/AR.js/three.js/build/ar.js"></script>

<a-scene embedded arjs>
    <a-marker type="pattern" preset="custom"
              url="https://github.com/NadiiaSky/NadiiaSky.github.io/blob/main/pattern-N.patt">
        <a-entity
                position="0 -1 0"
                scale="0.05 0.05 0.05"
                gltf-model="https://arjs-cors-proxy.herokuapp.com/https://raw.githack.com/AR-js-org/AR.js/master/aframe/examples/image-tracking/nft/trex/scene.gltf"
        ></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<script>
  // main function for generating the 3d figure
  var createDingDong = function(u, v, vector3) {
    //u in [0; 2Pi],  v in (-infinity; 1)
    u *= 2 * Math.PI;
    v = v * -2 + 1;


    var arg = v * Math.sqrt(1 - v);
    vector3.x = arg * Math.cos(u);
    vector3.y = arg * Math.sin(u);
    vector3.z = v;
  }
  // set scene argument
  var scene = new THREE.Scene();

  // set camera argument
  var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

  var renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // array of functions for the rendering loop
  var onRenderFcts = [];

  ///////////////////////////////////////
  // create arToolkitSource
  var arToolkitSource = new THREEx.ArToolkitSource({
    // to read from the webcam
    sourceType: 'webcam',

    // to read from an image
    // sourceType : 'image',
    // sourceUrl : THREEx.ArToolkitContext.baseURL + '../data/images/img.jpg',

    // to read from a video
    // sourceType : 'video',
    // sourceUrl : THREEx.ArToolkitContext.baseURL + '../data/videos/headtracking.mp4',
  })
  // initialize arToolkitSource
  arToolkitSource.init(function onReady() {
    onResize();
  })

  // handle resize
  window.addEventListener('resize', function(){
    onResize();
  })

  function onResize(){
    arToolkitSource.onResizeElement();
    arToolkitSource.copyElementSizeTo(renderer.domElement);
    if( arToolkitContext.arController !== null ){
        arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas);
    }
  }

  ///////////////////////////////////////
  // create arToolkitContext
  var arToolkitContext = new THREEx.ArToolkitContext({
    cameraParametersUrl: 'http://thorstenbux.github.io/jsartoolkit5/examples/Data/camera_para.dat',
    detectionMode: 'mono',
    maxDetectionRate: 30,
    canvasWidth: 80*3,
    canvasHeight: 60*3,
  })
  // initialize arToolkitContext
  arToolkitContext.init(function onCompleted(){
    // copy projection matrix to camera
    camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
  })

  // update artoolkit on every frame
  onRenderFcts.push(function(){
    if( arToolkitSource.ready === false )	return

    arToolkitContext.update( arToolkitSource.domElement );
  })

  ///////////////////////////////////////
  // create ArMarkerControls
  var markerRoot = new THREE.Group;
  scene.add(markerRoot)
  var artoolkitMarker = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
    type : 'pattern',
    //patternUrl : 'http://thorstenbux.github.io/jsartoolkit5/examples/Data/patt.hiro',
    patternUrl : 'https://nadiiasky.github.io/pattern-N.patt',
  })

  // build a smoothedControls
  var smoothedRoot = new THREE.Group();
  scene.add(smoothedRoot);
  var smoothedControls = new THREEx.ArSmoothedControls(smoothedRoot, {
    lerpPosition: 0.4,
    lerpQuaternion: 0.3,
    lerpScale: 1,
  })

  onRenderFcts.push(function(delta){
    smoothedControls.update(markerRoot);
  })

  ///////////////////////////////////////
  // add the surface on the scene

  var arWorldRoot = smoothedRoot;

  //  ParametricGeometry - a function that takes in a u and v value each between 0 and 1 and modifies a third Vector3
  //  argument
  var geometry = new THREE.ParametricGeometry(createDingDong, 50, 50);
  var material = new THREE.MeshBasicMaterial( {
    color: 0x0000ff,
    side: THREE.DoubleSide,
    wireframe: false,
    //vertexColors: true,
  } );

  var dingdong = new THREE.Mesh( geometry, material ); // first layer of the surface for 'metal' look
  dingdong.position.y = geometry.parameters.height/2;
  arWorldRoot.add( dingdong );

  var geometry2 = new THREE.ParametricGeometry(createDingDong, 50, 50);
  var material2 = new THREE.MeshBasicMaterial( {
    color: 0x440000,
    side: THREE.DoubleSide,
    wireframe: true,
  } );
  var dingdong2 = new THREE.Mesh( geometry2, material2 );
  dingdong2.position.y = 0.5;
   arWorldRoot.add( dingdong2 );

   onRenderFcts.push(function(){
     dingdong.rotation.x += 0.1;
     //dingdong.rotation.y += 0.01;
     dingdong2.rotation.x += 0.01;
     //dingdong2.rotation.y += 0.01;
   })

  ///////////////////////////////////////
  // rendering all on the page
  var stats = new Stats();
  document.body.appendChild( stats.dom );
  // render the scene
  onRenderFcts.push(function(){
    renderer.render( scene, camera );
    stats.update();
  })

  // run the rendering loop
  var lastTimeMsec= null;
  requestAnimationFrame(function animate(nowMsec){
    // keep looping
    requestAnimationFrame( animate );
    // measure time
    lastTimeMsec = lastTimeMsec || nowMsec-1000/60;
    var deltaMsec = Math.min(200, nowMsec - lastTimeMsec);
    lastTimeMsec = nowMsec;
    // call each update function
    onRenderFcts.forEach(function(onRenderFct){
      onRenderFct(deltaMsec/1000, nowMsec/1000);
    })
  })
</script>

</body>
</html>
